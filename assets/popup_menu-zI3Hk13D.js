(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(a){if(a.ep)return;a.ep=!0;const i=n(a);fetch(a.href,i)}})();const f="https://tasty-treats-backend.p.goit.global/api",o=(e,t=document)=>t.querySelector(e),y=(e,t=document)=>[...t.querySelectorAll(e)],h=e=>e&&e.classList.remove("hidden"),m=e=>e&&e.classList.add("hidden"),C=e=>(e??"").toString().replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t]);function E(e){const t=Number.parseFloat(String(e??"").replace(",","."));return Number.isFinite(t)?(Math.trunc(t*100)/100).toFixed(2):"0.00"}const $="../img/icons.svg",w=(e,t="")=>`<svg class="icon ${t}" aria-hidden="true" focusable="false">
     <use href="${$}#icon-${e}"></use>
   </svg>`;function S(){try{const e=JSON.parse(localStorage.getItem("favorites"));return Array.isArray(e)?e:[]}catch{return[]}}function O(e){localStorage.setItem("favorites",JSON.stringify(e||[]))}const g=e=>e?._id||e?.id||e?.recipeId||"",I=(e,t)=>(e||[]).findIndex(n=>String(g(n))===String(t));function H(e){const t=g(e);return{...e,_id:t,title:e?.title||"",description:e?.description||"",rating:Number(e?.rating)||0,preview:e?.preview||e?.thumb||e?.image_url||e?.imageUrl||"",category:typeof e?.category=="string"?{name:e.category}:e?.category?.name?e.category:e?.category||{}}}function b(e){return I(S(),e)!==-1}function R(e,t){const n=new CustomEvent("favorites:sync",{detail:{id:String(e),on:!!t}});window.dispatchEvent(n),document.dispatchEvent(n)}function F(){const e=new Event("favorites:updated");window.dispatchEvent(e),document.dispatchEvent(e)}function _(e,t){const n=S(),r=I(n,e);let a=!1;return r!==-1?(n.splice(r,1),a=!1):(n.unshift(H(t||{_id:e})),a=!0),O(n),R(e,a),F(),a}let l=null,u=0;window.__currentRecipeId="";function c(){return{overlay:o("#popup-overlay"),content:o("#popup-content"),pmImage:o("#pm-image"),pmVideo:o("#pm-video"),pmIframe:o("#pm-iframe"),pmTitle:o("#pm-title"),pmRatingVal:o("#pm-rating-val"),pmStars:o("#pm-stars"),pmTime:o("#pm-time"),pmIngredients:o("#pm-ingredients"),pmTags:o("#pm-tags"),pmDesc:o("#pm-desc"),favBtn:o("#pm-fav-btn"),rateBtn:o("#pm-rate-btn"),ratingOverlay:o("#rating-overlay"),ratingStars:o("#rating-stars"),ratingValueEl:o("#rating-value"),ratingEmail:o("#rating-email"),ratingSend:o("#rating-send"),ratingHint:o("#rating-hint")}}const A=`<span class="star filled">${w("Star")}</span>`,V=`<span class="star empty">${w("Star-empty")}</span>`;function L(e,t){if(!e)return;const n=Number(t)||0,r=Math.min(5,Math.max(0,Math.floor(n)));e.innerHTML=`<span class="star-row">
    ${A.repeat(r)}${V.repeat(5-r)}
  </span>`}function p(e){const t=c();if(!t.content)return;const n=String(g(e));n&&(t.content.dataset.recipeId=n,t.ratingOverlay&&(t.ratingOverlay.dataset.recipeId=n),window.__currentRecipeId=n),t.pmTitle&&(t.pmTitle.textContent=e.title||"Untitled"),t.pmRatingVal&&(t.pmRatingVal.textContent=E(e.rating)),L(t.pmStars,e.rating||0),t.pmTime&&(t.pmTime.textContent=e.time?`${e.time} min`:"");const r=e.youtube||e.youtubeUrl||"";if(r){t.pmVideo?.classList.remove("hidden"),t.pmImage?.classList.add("hidden");const a=r.match(/(?:v=|\/)([0-9A-Za-z_-]{11})(?:\b|&|$)/)?.[1]||r;t.pmIframe&&(t.pmIframe.src=`https://www.youtube.com/embed/${a}?rel=0&modestbranding=1&playsinline=1`)}else{t.pmVideo?.classList.add("hidden"),t.pmImage?.classList.remove("hidden");const a=e.image_url||e.imageUrl||e.preview||e.thumb||"";t.pmImage&&(t.pmImage.style.backgroundImage=a?`url('${C(a)}')`:"")}t.pmIngredients&&(t.pmIngredients.innerHTML="",(e.ingredients||[]).forEach(a=>{const i=typeof a=="string"?a:a?.name||"",s=typeof a=="string"?"":a?.measure||"",d=document.createElement("div");d.className="ing-row",d.innerHTML=`<span class="ing-name">${i}</span><span class="ig-measure">${s}</span>`,t.pmIngredients.appendChild(d)})),t.pmTags&&(t.pmTags.innerHTML="",(e.tags||[]).forEach(a=>{const i=document.createElement("span");i.className="tag-chip",i.textContent=`#${a}`,t.pmTags.appendChild(i)})),t.pmDesc&&(t.pmDesc.textContent=e.description||""),t.favBtn&&n&&(t.favBtn.textContent=b(n)?"Remove to favorite":"Add to favorite")}function v(){const e=c(),t=e.content?.dataset?.recipeId||window.__currentRecipeId||"";!e.favBtn||!t||(e.favBtn.textContent=b(t)?"Remove to favorite":"Add to favorite")}window.openPopup=async function(t){const n=c();if(!n.overlay)return;document.documentElement.style.overflow="hidden",l=typeof t=="object"&&t?t:{_id:String(t||"")},p(l),h(n.overlay),v();const r=g(l);if(r)try{const a=await fetch(`${f}/recipes/${encodeURIComponent(r)}`);if(a.ok){const i=await a.json();l={...l,...i},p(l),v()}}catch{}};document.addEventListener("click",e=>{const t=c();(e.target.closest(".popup-x")||t.overlay&&e.target===t.overlay)&&(m(t.overlay),document.documentElement.style.overflow="",t.pmIframe&&(t.pmIframe.src=""))});window.addEventListener("keydown",e=>{if(e.key!=="Escape")return;const t=c();if(t.ratingOverlay&&!t.ratingOverlay.classList.contains("hidden")){m(t.ratingOverlay);return}m(t.overlay),document.documentElement.style.overflow="",t.pmIframe&&(t.pmIframe.src="")});document.addEventListener("click",e=>{const t=c();if(!e.target.closest("#pm-fav-btn"))return;const n=t.content?.dataset?.recipeId||window.__currentRecipeId||"";if(!n)return;const r=_(n,l);t.favBtn&&(t.favBtn.textContent=r?"Remove to favorite":"Add to favorite")});function T(e){e&&y("svg path",e).forEach(t=>t.setAttribute("fill","#dcdcdc"))}function k(e,t){if(!e)return;T(e);const n=Math.floor(t),r=t%1>=.5;y(".star-container",e).forEach((a,i)=>{const s=i+1,d=o("path",a);d&&(s<=n?d.setAttribute("fill","#eea10b"):s===n+1&&r&&d.setAttribute("fill",`url(#halfGradient-${s})`))})}function x(e){const t=e.ratingEmail?.value.trim()||"",n=/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t),r=u>0&&n;e.ratingSend&&(e.ratingSend.disabled=!r),e.ratingHint&&(e.ratingHint.textContent=r?"":"Enter valid email and select rating.")}document.addEventListener("click",e=>{const t=c();if(e.target.closest("#pm-rate-btn")){u=0,t.ratingValueEl&&(t.ratingValueEl.textContent="0.00"),t.ratingEmail&&(t.ratingEmail.value=""),t.ratingHint&&(t.ratingHint.textContent=""),t.ratingSend&&(t.ratingSend.disabled=!0),T(t.ratingStars),h(t.ratingOverlay);return}(e.target.closest("#rating-close")||t.ratingOverlay&&e.target===t.ratingOverlay)&&m(t.ratingOverlay)});document.addEventListener("input",e=>{const t=c();e.target===t.ratingEmail&&x(t)});document.addEventListener("click",e=>{const t=c(),n=e.target.closest(".half-btn");if(!n||!t.ratingStars?.contains(n))return;const r=parseFloat(n.dataset.val||n.dataset.value);r&&(u=r,t.ratingValueEl&&(t.ratingValueEl.textContent=r.toFixed(2)),k(t.ratingStars,r),x(t))});document.addEventListener("click",async e=>{const t=c();if(!e.target.closest("#rating-send"))return;const n=t.ratingOverlay?.dataset?.recipeId||t.content?.dataset?.recipeId||"";if(!n)return;const r={rate:u,email:t.ratingEmail?.value.trim()||""};try{if(t.ratingSend&&(t.ratingSend.disabled=!0),!(await fetch(`${f}/recipes/${encodeURIComponent(n)}/rating`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})).ok)throw new Error("Failed to send rating");t.ratingHint&&(t.ratingHint.textContent="Thanks for rating!"),t.ratingHint&&t.ratingHint.classList.add("ok");try{const i=await fetch(`${f}/recipes/${encodeURIComponent(n)}`).then(s=>s.json());t.pmRatingVal&&(t.pmRatingVal.textContent=E(i?.rating)),L(t.pmStars,i?.rating??0)}catch{}setTimeout(()=>m(t.ratingOverlay),900)}catch(a){t.ratingHint&&(t.ratingHint.textContent=a?.message||"Error sending rating.",t.ratingHint.classList.remove("ok"))}finally{t.ratingSend&&(t.ratingSend.disabled=!1)}});
//# sourceMappingURL=popup_menu-zI3Hk13D.js.map
