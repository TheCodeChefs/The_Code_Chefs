(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function r(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(n){if(n.ep)return;n.ep=!0;const a=r(n);fetch(n.href,a)}})();const u="https://tasty-treats-backend.p.goit.global/api",o=(e,t=document)=>t.querySelector(e),w=(e,t=document)=>[...t.querySelectorAll(e)],p=e=>e&&e.classList.remove("hidden"),m=e=>e&&e.classList.add("hidden"),$=e=>(e??"").toString().replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t]),E=e=>{const t=Number.parseFloat(String(e??"").replace(",","."));return Number.isFinite(t)?(Math.trunc(t*100)/100).toFixed(2):"0.00"},k="../img/icons.svg";function I(e,t=""){return`<svg class="icon ${t}" aria-hidden="true" focusable="false">
    <use href="${k}#icon-${e}"></use>
  </svg>`}function S(){try{const e=JSON.parse(localStorage.getItem("favorites"));return Array.isArray(e)?e:[]}catch{return[]}}function v(e){localStorage.setItem("favorites",JSON.stringify(e||[])),window.dispatchEvent(new Event("favorites:updated"))}function b(e){return e?._id||e?.id||e?.recipeId||""}function L(e,t){const r=String(t);return(e||[]).findIndex(i=>String(b(i))===r)}function T(e){return L(S(),e)!==-1}function _(e){const t=b(e),r=e?.title||"",i=e?.description||"",n=Number(e?.rating)||0,a=e?.preview||e?.thumb||e?.image_url||e?.imageUrl||"";let s=e?.category;return s||(s=e?.category?.name||e?.categoryName||""),{...e,_id:t,title:r,description:i,rating:n,preview:a,category:typeof s=="string"?{name:s}:s||{}}}function H(e,t){const r=S(),i=L(r,e);if(i!==-1)return r.splice(i,1),v(r),!1;const n=_(t||{_id:e});return r.unshift(n),v(r),!0}let l=null,g=0;window.__currentRecipeId="";function c(){return{overlay:o("#popup-overlay"),content:o("#popup-content"),pmVideo:o("#pm-video"),pmIframe:o("#pm-iframe"),pmImage:o("#pm-image"),pmTitle:o("#pm-title"),pmRatingVal:o("#pm-rating-val"),pmStars:o("#pm-stars"),pmTime:o("#pm-time"),pmIngredients:o("#pm-ingredients"),pmTags:o("#pm-tags"),pmDesc:o("#pm-desc"),favBtn:o("#pm-fav-btn"),rateBtn:o("#pm-rate-btn"),ratingOverlay:o("#rating-overlay"),ratingStars:o("#rating-stars"),ratingValueEl:o("#rating-value"),ratingEmail:o("#rating-email"),ratingSend:o("#rating-send"),ratingHint:o("#rating-hint"),playBtn:o("#pm-play-btn"),clickCatcher:o("#pm-click-catcher")}}const B=`<span class="star filled">${I("Star")}</span>`,F=`<span class="star empty">${I("Star-empty")}</span>`;function C(e,t){if(!e)return;const r=Number.parseFloat(String(t??"").replace(",",".")),i=Number.isFinite(r)?r:0,n=Math.max(0,Math.min(5,Math.floor(i))),a=5-n;e.innerHTML=`<span class="star-row">
    ${B.repeat(n)}${F.repeat(a)}
  </span>`}function x(e){e&&w("svg path",e).forEach(t=>t.setAttribute("fill","#dcdcdc"))}function V(e,t){if(!e)return;x(e);const r=Math.floor(t),i=t%1>=.5;w(".star-container",e).forEach((n,a)=>{const s=a+1,d=o("path",n);d&&(s<=r?d.setAttribute("fill","#eea10b"):s===r+1&&i&&d.setAttribute("fill",`url(#halfGradient-${s})`))})}function O(e){const t=e.ratingEmail?.value.trim()||"",r=/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t),i=g>0&&r;e.ratingSend&&(e.ratingSend.disabled=!i),e.ratingHint&&(e.ratingHint.textContent=i?"":"Enter valid email and select rating.")}let f=!1;const N=780;function R(){const e=c();if(!e.content)return;const t=e.pmIngredients,r=e.pmTags,i=o(".meta-line",e.content);if(!(!r||!i)){if(window.innerWidth>=N){if(!f){const n=document.createElement("div");n.className="top-row",e.content.insertBefore(n,t),n.appendChild(r),n.appendChild(i),f=!0}}else if(f){e.content.insertBefore(i,t),e.content.insertBefore(r,e.pmDesc);const n=o(".top-row",e.content);n&&n.remove(),f=!1}}}function y(e){const t=c();if(!t.content)return;const r=String(e._id||e.id||"");r&&(t.content.dataset.recipeId=r,t.ratingOverlay&&(t.ratingOverlay.dataset.recipeId=r),window.__currentRecipeId=r),t.pmTitle&&(t.pmTitle.textContent=e.title||"Untitled"),t.pmRatingVal&&(t.pmRatingVal.textContent=E(e.rating)),C(t.pmStars,e.rating||0),t.pmTime&&(t.pmTime.textContent=e.time?e.time+" min":"");const i=e.youtube||e.youtubeUrl||"";if(i){p(t.pmVideo),m(t.pmImage);const n=i.match(/(?:v=|\/)([0-9A-Za-z_-]{11})(?:\b|&|$)/)?.[1]||i;t.pmIframe&&(t.pmIframe.src=`https://www.youtube.com/embed/${n}?enablejsapi=1&rel=0&modestbranding=1&playsinline=1`)}else{m(t.pmVideo),p(t.pmImage);const n=e.image_url||e.imageUrl||e.preview||e.thumb||"";t.pmImage&&(t.pmImage.style.backgroundImage=n?`url('${$(n)}')`:"")}t.pmIngredients&&(t.pmIngredients.innerHTML="",(e.ingredients||[]).forEach(n=>{const a=typeof n=="string"?n:n?.name||"",s=typeof n=="string"?"":n?.measure||"",d=document.createElement("div");d.className="ing-row",d.innerHTML=`<span class="ing-name">${a}</span><span class="ing-measure">${s}</span>`,t.pmIngredients.appendChild(d)})),t.pmTags&&(t.pmTags.innerHTML="",(e.tags||[]).forEach(n=>{const a=document.createElement("span");a.className="tag-chip",a.textContent=`#${n}`,t.pmTags.appendChild(a)})),t.pmDesc&&(t.pmDesc.textContent=e.description||""),t.favBtn&&r&&(t.favBtn.textContent=T(r)?"Remove favorite":"Add to favorite"),R()}function h(){const e=c(),t=e.content?.dataset?.recipeId||window.__currentRecipeId||"";!e.favBtn||!t||(e.favBtn.textContent=T(t)?"Remove favorite":"Add to favorite")}window.openPopup=async function(t){const r=c();if(!r.overlay)return;document.documentElement.style.overflow="hidden",typeof t=="object"&&t?l=t:l={_id:String(t??"")},y(l),p(r.overlay),h();const i=String(l._id||l.id||"");if(i)try{const n=await fetch(`${u}/recipes/${encodeURIComponent(i)}`);if(n.ok){const a=await n.json();l={...l,...a},y(l),h()}}catch{}};document.addEventListener("click",e=>{const t=c();(e.target.closest(".popup-x")||t.overlay&&e.target===t.overlay)&&(m(t.overlay),document.documentElement.style.overflow="",t.pmIframe&&(t.pmIframe.src=""))});window.addEventListener("keydown",e=>{if(!(e.key==="Escape"&&!o("#rating-overlay.hidden"))&&e.key==="Escape"){const t=c();m(t.overlay),document.documentElement.style.overflow="",t.pmIframe&&(t.pmIframe.src="")}});document.addEventListener("click",e=>{const t=c();if(!e.target.closest("#pm-fav-btn"))return;const r=t.content?.dataset?.recipeId||window.__currentRecipeId||"";if(!r)return;const i=H(r,l);t.favBtn&&(t.favBtn.textContent=i?"Remove favorite":"Add to favorite"),window.dispatchEvent(new Event("favorites:updated"))});(function(){const t=c();t.pmVideo&&(t.playBtn?.addEventListener("click",()=>{if(!t.pmIframe?.src)return;const r=t.pmIframe.src.includes("?")?"&":"?";t.pmIframe.src.includes("autoplay=1")||(t.pmIframe.src+=`${r}autoplay=1`),t.pmVideo.classList.add("is-playing")}),t.clickCatcher?.addEventListener("click",()=>{t.pmIframe?.src&&(t.pmIframe.src=t.pmIframe.src.replace(/[?&]autoplay=1/,""),t.pmVideo.classList.remove("is-playing"))}))})();document.addEventListener("click",e=>{const t=c();if(e.target.closest("#pm-rate-btn")){g=0,t.ratingValueEl&&(t.ratingValueEl.textContent="0.00"),t.ratingEmail&&(t.ratingEmail.value=""),t.ratingHint&&(t.ratingHint.textContent=""),t.ratingSend&&(t.ratingSend.disabled=!0),x(t.ratingStars),p(t.ratingOverlay);return}(e.target.closest("#rating-close")||t.ratingOverlay&&e.target===t.ratingOverlay)&&m(t.ratingOverlay)});window.addEventListener("keydown",e=>{if(e.key!=="Escape")return;const t=c();t.ratingOverlay?.classList.contains("hidden")||m(t.ratingOverlay)});document.addEventListener("click",e=>{const t=c(),r=e.target.closest(".half-btn");if(!r||!t.ratingStars?.contains(r))return;const i=parseFloat(r.dataset.val||r.dataset.value);i&&(g=i,t.ratingValueEl&&(t.ratingValueEl.textContent=i.toFixed(2)),V(t.ratingStars,i),O(t))});document.addEventListener("input",e=>{const t=c();e.target===t.ratingEmail&&O(t)});document.addEventListener("click",async e=>{const t=c();if(!e.target.closest("#rating-send"))return;const r=t.ratingOverlay?.dataset?.recipeId||t.content?.dataset?.recipeId||"";if(!r)return;const i={rate:g,email:t.ratingEmail?.value.trim()||""};try{if(t.ratingSend&&(t.ratingSend.disabled=!0),!(await fetch(`${u}/recipes/${encodeURIComponent(r)}/rating`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)})).ok)throw new Error("Failed to send rating");t.ratingHint&&(t.ratingHint.textContent="Thanks for rating!",t.ratingHint.classList.add("ok"));try{const a=await fetch(`${u}/recipes/${encodeURIComponent(r)}`).then(s=>s.json());t.pmRatingVal&&(t.pmRatingVal.textContent=E(a?.rating)),C(t.pmStars,a?.rating??0)}catch{}setTimeout(()=>m(t.ratingOverlay),900)}catch(n){t.ratingHint&&(t.ratingHint.textContent=n?.message||"Error sending rating.",t.ratingHint.classList.remove("ok"))}finally{t.ratingSend&&(t.ratingSend.disabled=!1)}});window.addEventListener("resize",R);
//# sourceMappingURL=popup_menu-C-lSVEW9.js.map
