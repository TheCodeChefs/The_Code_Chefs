(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(a){if(a.ep)return;a.ep=!0;const i=n(a);fetch(a.href,i)}})();const v=document.querySelector(".hamburger-button"),g=document.querySelector(".mobile-menu"),w=document.querySelector(".nav-menu"),F=document.querySelector(".close-button"),S=document.querySelector(".toggle-label"),u=document.querySelector(".toggle");v.addEventListener("click",()=>{g.classList.add("show"),v.classList.add(".show"),w.classList.add("nav-show"),S.classList.add("toggle-label-show"),u.classList.add("toggle-label-show")});F.addEventListener("click",()=>{g.classList.remove("show"),v.classList.remove(".show"),w.classList.remove("nav-show"),S.classList.remove("toggle-label-show"),u.classList.remove("toggle-label-show")});u.addEventListener("change",()=>{u.checked?(document.body.setAttribute("data-theme","dark"),g.classList.add("mobile-menu-color")):(document.body.setAttribute("data-theme","light"),g.classList.remove("mobile-menu-color"))});const y="https://tasty-treats-backend.p.goit.global/api",o=(e,t=document)=>t.querySelector(e),E=(e,t=document)=>[...t.querySelectorAll(e)],L=e=>e&&e.classList.remove("hidden"),m=e=>e&&e.classList.add("hidden"),_=e=>(e??"").toString().replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t]);function I(e){const t=Number.parseFloat(String(e??"").replace(",","."));return Number.isFinite(t)?(Math.trunc(t*100)/100).toFixed(2):"0.00"}const k="../img/icons.svg",T=(e,t="")=>`<svg class="icon ${t}" aria-hidden="true" focusable="false">
     <use href="${k}#icon-${e}"></use>
   </svg>`;function x(){try{const e=JSON.parse(localStorage.getItem("favorites"));return Array.isArray(e)?e:[]}catch{return[]}}function A(e){localStorage.setItem("favorites",JSON.stringify(e||[]))}const f=e=>e?._id||e?.id||e?.recipeId||"",C=(e,t)=>(e||[]).findIndex(n=>String(f(n))===String(t));function B(e){const t=f(e);return{...e,_id:t,title:e?.title||"",description:e?.description||"",rating:Number(e?.rating)||0,preview:e?.preview||e?.thumb||e?.image_url||e?.imageUrl||"",category:typeof e?.category=="string"?{name:e.category}:e?.category?.name?e.category:e?.category||{}}}function $(e){return C(x(),e)!==-1}function M(e,t){const n=new CustomEvent("favorites:sync",{detail:{id:String(e),on:!!t}});window.dispatchEvent(n),document.dispatchEvent(n)}function V(){const e=new Event("favorites:updated");window.dispatchEvent(e),document.dispatchEvent(e)}function q(e,t){const n=x(),r=C(n,e);let a=!1;return r!==-1?(n.splice(r,1),a=!1):(n.unshift(B(t||{_id:e})),a=!0),A(n),M(e,a),V(),a}let d=null,p=0;window.__currentRecipeId="";function c(){return{overlay:o("#popup-overlay"),content:o("#popup-content"),pmImage:o("#pm-image"),pmVideo:o("#pm-video"),pmIframe:o("#pm-iframe"),pmTitle:o("#pm-title"),pmRatingVal:o("#pm-rating-val"),pmStars:o("#pm-stars"),pmTime:o("#pm-time"),pmIngredients:o("#pm-ingredients"),pmTags:o("#pm-tags"),pmDesc:o("#pm-desc"),favBtn:o("#pm-fav-btn"),rateBtn:o("#pm-rate-btn"),ratingOverlay:o("#rating-overlay"),ratingStars:o("#rating-stars"),ratingValueEl:o("#rating-value"),ratingEmail:o("#rating-email"),ratingSend:o("#rating-send"),ratingHint:o("#rating-hint")}}const N=`<span class="star filled">${T("Star")}</span>`,P=`<span class="star empty">${T("Star-empty")}</span>`;function O(e,t){if(!e)return;const n=Number(t)||0,r=Math.min(5,Math.max(0,Math.floor(n)));e.innerHTML=`<span class="star-row">
    ${N.repeat(r)}${P.repeat(5-r)}
  </span>`}function h(e){const t=c();if(!t.content)return;const n=String(f(e));n&&(t.content.dataset.recipeId=n,t.ratingOverlay&&(t.ratingOverlay.dataset.recipeId=n),window.__currentRecipeId=n),t.pmTitle&&(t.pmTitle.textContent=e.title||"Untitled"),t.pmRatingVal&&(t.pmRatingVal.textContent=I(e.rating)),O(t.pmStars,e.rating||0),t.pmTime&&(t.pmTime.textContent=e.time?`${e.time} min`:"");const r=e.youtube||e.youtubeUrl||"";if(r){t.pmVideo?.classList.remove("hidden"),t.pmImage?.classList.add("hidden");const a=r.match(/(?:v=|\/)([0-9A-Za-z_-]{11})(?:\b|&|$)/)?.[1]||r;t.pmIframe&&(t.pmIframe.src=`https://www.youtube.com/embed/${a}?rel=0&modestbranding=1&playsinline=1`)}else{t.pmVideo?.classList.add("hidden"),t.pmImage?.classList.remove("hidden");const a=e.image_url||e.imageUrl||e.preview||e.thumb||"";t.pmImage&&(t.pmImage.style.backgroundImage=a?`url('${_(a)}')`:"")}t.pmIngredients&&(t.pmIngredients.innerHTML="",(e.ingredients||[]).forEach(a=>{const i=typeof a=="string"?a:a?.name||"",s=typeof a=="string"?"":a?.measure||"",l=document.createElement("div");l.className="ing-row",l.innerHTML=`<span class="ing-name">${i}</span><span class="ig-measure">${s}</span>`,t.pmIngredients.appendChild(l)})),t.pmTags&&(t.pmTags.innerHTML="",(e.tags||[]).forEach(a=>{const i=document.createElement("span");i.className="tag-chip",i.textContent=`#${a}`,t.pmTags.appendChild(i)})),t.pmDesc&&(t.pmDesc.textContent=e.description||""),t.favBtn&&n&&(t.favBtn.textContent=$(n)?"Remove to favorite":"Add to favorite")}function b(){const e=c(),t=e.content?.dataset?.recipeId||window.__currentRecipeId||"";!e.favBtn||!t||(e.favBtn.textContent=$(t)?"Remove to favorite":"Add to favorite")}window.openPopup=async function(t){const n=c();if(!n.overlay)return;document.documentElement.style.overflow="hidden",d=typeof t=="object"&&t?t:{_id:String(t||"")},h(d),L(n.overlay),b();const r=f(d);if(r)try{const a=await fetch(`${y}/recipes/${encodeURIComponent(r)}`);if(a.ok){const i=await a.json();d={...d,...i},h(d),b()}}catch{}};document.addEventListener("click",e=>{const t=c();(e.target.closest(".popup-x")||t.overlay&&e.target===t.overlay)&&(m(t.overlay),document.documentElement.style.overflow="",t.pmIframe&&(t.pmIframe.src=""))});window.addEventListener("keydown",e=>{if(e.key!=="Escape")return;const t=c();if(t.ratingOverlay&&!t.ratingOverlay.classList.contains("hidden")){m(t.ratingOverlay);return}m(t.overlay),document.documentElement.style.overflow="",t.pmIframe&&(t.pmIframe.src="")});document.addEventListener("click",e=>{const t=c();if(!e.target.closest("#pm-fav-btn"))return;const n=t.content?.dataset?.recipeId||window.__currentRecipeId||"";if(!n)return;const r=q(n,d);t.favBtn&&(t.favBtn.textContent=r?"Remove to favorite":"Add to favorite")});function H(e){e&&E("svg path",e).forEach(t=>t.setAttribute("fill","#dcdcdc"))}function U(e,t){if(!e)return;H(e);const n=Math.floor(t),r=t%1>=.5;E(".star-container",e).forEach((a,i)=>{const s=i+1,l=o("path",a);l&&(s<=n?l.setAttribute("fill","#eea10b"):s===n+1&&r&&l.setAttribute("fill",`url(#halfGradient-${s})`))})}function R(e){const t=e.ratingEmail?.value.trim()||"",n=/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t),r=p>0&&n;e.ratingSend&&(e.ratingSend.disabled=!r),e.ratingHint&&(e.ratingHint.textContent=r?"":"Enter valid email and select rating.")}document.addEventListener("click",e=>{const t=c();if(e.target.closest("#pm-rate-btn")){p=0,t.ratingValueEl&&(t.ratingValueEl.textContent="0.00"),t.ratingEmail&&(t.ratingEmail.value=""),t.ratingHint&&(t.ratingHint.textContent=""),t.ratingSend&&(t.ratingSend.disabled=!0),H(t.ratingStars),L(t.ratingOverlay);return}(e.target.closest("#rating-close")||t.ratingOverlay&&e.target===t.ratingOverlay)&&m(t.ratingOverlay)});document.addEventListener("input",e=>{const t=c();e.target===t.ratingEmail&&R(t)});document.addEventListener("click",e=>{const t=c(),n=e.target.closest(".half-btn");if(!n||!t.ratingStars?.contains(n))return;const r=parseFloat(n.dataset.val||n.dataset.value);r&&(p=r,t.ratingValueEl&&(t.ratingValueEl.textContent=r.toFixed(2)),U(t.ratingStars,r),R(t))});document.addEventListener("click",async e=>{const t=c();if(!e.target.closest("#rating-send"))return;const n=t.ratingOverlay?.dataset?.recipeId||t.content?.dataset?.recipeId||"";if(!n)return;const r={rate:p,email:t.ratingEmail?.value.trim()||""};try{if(t.ratingSend&&(t.ratingSend.disabled=!0),!(await fetch(`${y}/recipes/${encodeURIComponent(n)}/rating`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})).ok)throw new Error("Failed to send rating");t.ratingHint&&(t.ratingHint.textContent="Thanks for rating!"),t.ratingHint&&t.ratingHint.classList.add("ok");try{const i=await fetch(`${y}/recipes/${encodeURIComponent(n)}`).then(s=>s.json());t.pmRatingVal&&(t.pmRatingVal.textContent=I(i?.rating)),O(t.pmStars,i?.rating??0)}catch{}setTimeout(()=>m(t.ratingOverlay),900)}catch(a){t.ratingHint&&(t.ratingHint.textContent=a?.message||"Error sending rating.",t.ratingHint.classList.remove("ok"))}finally{t.ratingSend&&(t.ratingSend.disabled=!1)}});
//# sourceMappingURL=popup_menu-BjtrdsJh.js.map
